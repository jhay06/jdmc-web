from products.product_class import ProductClass,jq
from browser import alert,confirm
from utils.file_reader import FileUploadReader,FileModel
from validations.file.file_validation import FileValidation
from promotion.add_promotion import AddPromotion
from promotion.get_promotion_list import GetPromotionList
from promotion.update_promotion import UpdatePromotion
from utils.loader import Loader
class Promotion:
    def __init__(self) -> None:
        self.loader=Loader()
    

       

    def get_promotion_list_page(self):
        get_prod_list=GetPromotionList("#promotion_dt")
        get_prod_list.load()
    
    def update_promotion_page(self):
       
        update_promotion=UpdatePromotion()
        def on_file_load(element, file:FileModel):
            if len(file.file_temp_content) < 1000:
                alert('Minimum size of image should be 1kb')
                element.val("")
                return
            if len(file.file_temp_content) > 3000000:
                alert('Image size must not be larger than 3MB')
                element.val("")
                return
        def change_file_click(e,update_promotion:UpdatePromotion):
            e.preventDefault()
            conf=confirm("Clicking this button will require you to upload new image, Continue?")
            if conf:
                update_promotion.upload_new_file=True
                jq('.has_file').addClass('hide')
                jq('#promotion_img').removeClass('hide')
                file_upload=FileUploadReader(jq("#promotion_img"))
                file_upload.on_file_load(on_file_load)
                update_promotion.add_upload_reader(file_upload)
        jq('button.change_file').unbind('click')
        jq('button.change_file').bind('click',lambda e, prod=update_promotion:change_file_click(e,prod))
    
    

    def add_promotion_page(self):
     
        def on_file_load(element,file:FileModel):
            if len(file.file_temp_content) < 1000:
                alert('Minimum size of image should be 1kb')
                element.val("")
                return
            if len(file.file_temp_content) > 3000000:
                alert('Image size must not be larger than 3MB')
                element.val("")
                return

       
        file_upload=FileUploadReader(jq('input#promotion_img'))
        file_upload.on_file_load(on_file_load)
        add_promotion=AddPromotion(file_upload)

