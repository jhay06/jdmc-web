import jquery
from browser import window
jq=window.jQuery
import json
class ProductClass:
    def __init__(self) -> None:
        self.cable='/modules/api_cable/product_class_cable.php'
        self.__onload=None
        self.__onerror=None
        self.__onloadfinish=None
    def on_load_finish(self,cb):
        self.__onloadfinish=cb
    def on_load(self,cb):
        self.__onload=cb
    def on_error(self,cb):
        self.__onerror=cb
    
    def on_get(self,res,status,xhr):
        if status=='success':
            try:
                js=json.loads(res)
                if js['status']=='success':
                    data=js['data']
                    for x in data:
                        if self.__onload is not None:
                            self.__onload(x)
                    if self.__onloadfinish is not None:
                        self.__onloadfinish()
                else:
                    if self.__onerror is not None:
                        self.__onerror(js)
            except:
                if self.__onerror is not None:
                    self.__onerror({
                        'status':'error',
                        'message':'Parse error'
                    })
        else:
            if self.__onerror is not None:
                self.__onerror({
                    'status':'error',
                    'message':'Unknown error'
                })

    def on_failed(self,res,status,xhr):
        if self.__onerror is not None:
            self.__onerror({
                'status':'error',
                'message':'Connection not established'
            })
    def get_product_list(self):
        jq.post(self.cable,{'get_product_class':'ok'}
        ,self.on_get).fail(self.on_failed)