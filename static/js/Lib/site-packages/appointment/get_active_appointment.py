import jquery
from browser import window,alert
import json
jq=window.jQuery
class GetActiveAppointment:
    def __init__(self,cb):
        self.url_by_range='/modules/api_cable/get_active_appointment_by_range.php'
        self.url_by_username='/modules/api_cable/get_active_appointment.php'
        self.__cb=cb
    def list_connection_ok(self,res,status,xhr):
        if status=='success':
            
            js=json.loads(res)
            if js['status'] =='success':
                if self.__cb is not None:
                    self.__cb(True,'Connection established',js)
                else:
                    self.__cb(False,js['message'],None)
        else:
            pass

    def list_connection_failed(self,res,status,xhr):
        if self.__cb is not None:
            self.__cb(False,'Connection to the server failed',None)
    def get_appointment_list_with_range(self,branch,from_range,to_range):
        if (branch is not None
            and from_range is not None
            and to_range is not None
        ):
            data={
                'branch_code':branch['branch_code'],
                'get_active_appointment':'ok',
                'from_range':from_range,
                'to_range':to_range
            }
            jq.post(self.url_by_range,data,self.list_connection_ok).fail(self.list_connection_failed)
    def get_appointment_list(self,branch):
        if branch is not None:
            data={
                'branch_code':branch['branch_code'],
                'get_active_appointment':'ok'
            }
            jq.post(self.url_by_username,data,self.list_connection_ok).fail(self.list_connection_failed)
        